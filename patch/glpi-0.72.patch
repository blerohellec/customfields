--- inc/search.function.php	2009-06-09 09:14:40.000000000 -0700
+++ inc/search.function.php	2009-06-09 09:17:49.000000000 -0700
@@ -77,6 +77,13 @@
 			}
 		}
 	}
+	////////// begin modification for custom fields plugin /////////
+	$plugin = new Plugin();
+	if ($plugin->isActivated('customfields'))
+	{
+		$options = plugin_customfields_cleanSearchOption($options, $action);
+	}
+	////////// end modification for custom fields plugin /////////
 
 	return $options;
 }
--- ajax/dropdownMassiveActionField.php	2009-06-09 09:32:08.000000000 -0700
+++ ajax/dropdownMassiveActionField.php	2009-06-10 16:00:49.000000000 -0700
@@ -200,6 +200,15 @@
 							$_POST["device_type"],$search["table"],$search["field"],$search["linkfield"]);
 					} 
 				} 
+ 				////////// begin modification for custom fields plugin /////////
+ 				elseif (substr($search["table"],0,34)=='glpi_dropdown_plugin_customfields_' || substr($search["table"],0,25)=='glpi_plugin_customfields_')
+ 				{
+ 					$function='plugin_customfields_MassiveActionsFieldsDisplay';
+ 					if (function_exists($function)){
+ 						$plugdisplay=$function($_POST["device_type"],$search["table"],$search["field"],$search["linkfield"]);
+ 					}
+ 				}
+ 				////////// end modification for custom fields plugin ///////// 
 				if (!$plugdisplay){
 					dropdown($search["table"],$search["linkfield"],1,$_SESSION["glpiactive_entity"]);
 				}
--- plugins/customfields/setup.php	2009-06-10 15:49:03.000000000 -0700
+++ plugins/customfields/setup.php	2009-06-10 15:48:41.000000000 -0700
@@ -37,7 +37,7 @@
 
 // This will be set to true when applying the glpi patch. 
 // See instructions in the patch directory
-define('CUSTOMFIELDS_GLPI_PATCH_APPLIED', false);
+define('CUSTOMFIELDS_GLPI_PATCH_APPLIED', true);
 
 // If auto activate set to true, custom fields will be automatically
 // added when a new record is inserted. If set to false, users must
